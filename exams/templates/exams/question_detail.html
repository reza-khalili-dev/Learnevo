{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
    <h2>Question Detail</h2>
    <hr>

    <h4>{{ question.text }}</h4>
    <p><strong>Type:</strong> {{ question.get_qtype_display }}</p>
    <p><strong>Points:</strong> {{ question.points }}</p>

    <!-- Audio question -->
    {% if question.audio_file %}
        <div class="mt-3">
            <p><strong>Audio:</strong></p>
            <audio controls>
                <source src="{{ question.audio_file.url }}">
                Your browser does not support audio.
            </audio>
        </div>
    {% endif %}

    <!-- Image question -->
    {% if question.image_file %}
        <div class="mt-3">
            <p><strong>Image:</strong></p>
            <img src="{{ question.image_file.url }}" class="img-fluid rounded" style="max-width:350px;">
        </div>
    {% endif %}

    <hr>

    {% if question.qtype in "mcq audio_mcq image_mcq" %}
        <h5>Choices</h5>

        <ul class="list-group mb-3">
            {% for choice in question.choices.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ choice.text }}
                        {% if choice.is_correct %}
                            <span class="badge bg-success ms-2">Correct</span>
                        {% endif %}
                    </span>

                    <div>
                        <a href="{% url 'exams:choice_edit' choice.pk %}" class="btn btn-sm btn-outline-primary">Edit</a>
                        <a href="{% url 'exams:choice_delete' choice.pk %}" class="btn btn-sm btn-outline-danger">Delete</a>
                    </div>
                </li>

            {% empty %}
                <li class="list-group-item">No choices yet</li>
            {% endfor %}
        </ul>

        <a href="{% url 'exams:choice_add' question.id %}" class="btn btn-sm btn-success">+ Add Choice</a>
    {% else %}
        <div class="alert alert-info">
            This is an Essay-based question. No choices required.
        </div>
    {% endif %}

    <a href="{% url 'exams:exam_detail' question.exam.id %}" class="btn btn-sm btn-secondary mt-3">Back</a>
</div>
{% endblock %}
